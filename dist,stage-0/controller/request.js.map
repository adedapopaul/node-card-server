{"version":3,"sources":["../../src/controller/request.js"],"names":["randomize","require","nodemailer","transporter","createTransport","service","auth","user","pass","config","db","api","get","req","res","Request","find","err","users","console","log","json","name","params","post","newRequest","body","username","device","phone","email","address","save","mailOptions","from","to","subject","html","sendMail","message"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,YAAYC,QAAQ,YAAR,CAAlB;AACA,IAAMC,aAAaD,QAAQ,YAAR,CAAnB;;AAEA,IAAME,cAAcD,WAAWE,eAAX,CAA2B;AAC7CC,WAAS,OADoC;AAE7CC,QAAM;AACJC,UAAM,uBADF;AAEJC,UAAM;AAFF;AAFuC,CAA3B,CAApB;;kBAQc,gBAAoB;AAAA,MAAjBC,MAAiB,QAAjBA,MAAiB;AAAA,MAATC,EAAS,QAATA,EAAS;;AAChC,MAAIC,MAAM,sBAAV;;AAEA;AACAA,MAAIC,GAAJ,CAAQ,GAAR,EAAa,UAACC,GAAD,EAAMC,GAAN,EAAc;AACzBC,sBAAQC,IAAR,CAAa,EAAb,EAAiB,UAACC,GAAD,EAAMC,KAAN,EAAgB;AAC/B,UAAID,GAAJ,EAAS;AACPE,gBAAQC,GAAR,CAAYH,GAAZ;AACD;AACDH,UAAIO,IAAJ,CAASH,KAAT;AACD,KALD;AAMD,GAPD;;AASA;AACAP,MAAIC,GAAJ,CAAQ,QAAR,EAAkB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC9BC,sBAAQC,IAAR,CAAa,EAACM,MAAMT,IAAIU,MAAJ,CAAWD,IAAlB,EAAb,EAAsC,UAACL,GAAD,EAAMV,IAAN,EAAe;AACnD,UAAIU,GAAJ,EAAS;AACPE,gBAAQC,GAAR,CAAYH,GAAZ;AACD;AACDH,UAAIO,IAAJ,CAASd,IAAT;AACD,KALD;AAMD,GAPD;;AASA;AACAI,MAAIa,IAAJ,CAAS,UAAT,EAAqB,UAACX,GAAD,EAAMC,GAAN,EAAc;;AAE7B;AACA,QAAIW,aAAa,IAAIV,iBAAJ,EAAjB;AACAU,eAAWH,IAAX,GAAkBT,IAAIa,IAAJ,CAASJ,IAA3B;AACAG,eAAWE,QAAX,GAAsBd,IAAIa,IAAJ,CAASC,QAA/B;AACAF,eAAWG,MAAX,GAAoBf,IAAIa,IAAJ,CAASE,MAA7B;AACAH,eAAWI,KAAX,GAAmBhB,IAAIa,IAAJ,CAASG,KAA5B;AACAJ,eAAWK,KAAX,GAAmBjB,IAAIa,IAAJ,CAASI,KAA5B;AACAL,eAAWM,OAAX,GAAqBlB,IAAIa,IAAJ,CAASK,OAA9B;;AAEAN,eAAWO,IAAX,CAAgB,UAASf,GAAT,EAAcV,IAAd,EAAoB;AAClC,UAAIU,GAAJ,EAAS;AACPE,gBAAQC,GAAR,CAAYH,GAAZ;AACD;AACE;AACG,UAAIa,QAAQjB,IAAIa,IAAJ,CAASI,KAArB;AACAX,cAAQC,GAAR,CAAYU,KAAZ;AACA,UAAIG,cAAc;AAChBC,cAAM,gCADU;AAEhBC,YAAIL,KAFY;AAGhBM,iBAAS,kBAHO;AAIhBC,cAAM;;AAGZ;AAPsB,OAAlB,CAQJlC,YAAYmC,QAAZ,CAAqBL,WAArB;AACAnB,UAAIO,IAAJ,CAAS,EAAEkB,SAAS,uBAAX,EAAT;AACH,KAjBD;AAmBH,GA9BH;;AAiCA,SAAO5B,GAAP;AACD,C","file":"request.js","sourcesContent":["import mongoose from 'mongoose';\r\nimport { Router } from 'express';\r\nimport Request from '../model/request';\r\nimport bodyParser from 'body-parser';\r\nimport passport from 'passport';\r\n\r\nconst randomize = require('randomatic');\r\nconst nodemailer = require('nodemailer');\r\n\r\nconst transporter = nodemailer.createTransport({\r\n  service: 'gmail',\r\n  auth: {\r\n    user: 'adedapopaul@gmail.com',\r\n    pass: 'moronkeji'\r\n  }\r\n});\r\n\r\nexport default({ config, db }) => {\r\n  let api = Router();\r\n\r\n  // '/v1/request' - GET all request\r\n  api.get('/', (req, res) => {\r\n    Request.find({}, (err, users) => {\r\n      if (err) {\r\n        console.log(err)\r\n      }\r\n      res.json(users);\r\n    });\r\n  });\r\n\r\n  // '/v1/request/:name' - GET a specific user request\r\n  api.get('/:name', (req, res) => {\r\n    Request.find({name: req.params.name}, (err, user) => {\r\n      if (err) {\r\n        console.log(err)\r\n      }\r\n      res.json(user);\r\n    });\r\n  });\r\n\r\n  // '/v1/request' - POST - update a user  \r\n  api.post('/request', (req, res) => {\r\n        \r\n        // create user profile\r\n        let newRequest = new Request();\r\n        newRequest.name = req.body.name;\r\n        newRequest.username = req.body.username;\r\n        newRequest.device = req.body.device;\r\n        newRequest.phone = req.body.phone;\r\n        newRequest.email = req.body.email;\r\n        newRequest.address = req.body.address;\r\n\r\n        newRequest.save(function(err, user) {\r\n          if (err) {\r\n            console.log(err);\r\n          }\r\n             // send notification email to buyer\r\n                let email = req.body.email;\r\n                console.log(email)\r\n                var mailOptions = {\r\n                  from: 'noreplySale@jyqwinslimited.com',\r\n                  to: email,\r\n                  subject: 'You are Welcome!',\r\n                  html: '<h3>Dear Valued Customer </h3><p>Thank you for getting in touch with us. We have received your request for a licence. One of our team will get in touch with you soon.</p><p>You can also Contact us on +234 816 787 6460 for any enquiry.</p><p> Many Thanks</p>'\r\n                }\r\n\r\n            // send mail with defined transport object\r\n            transporter.sendMail(mailOptions)\r\n            res.json({ message: 'Request has been sent'});\r\n        });\r\n\r\n    });\r\n\r\n\r\n  return api;\r\n}\r\n"]}